<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ReservationMapper">

    <!-- 예약신청 생성 -->
    <insert id="create" parameterType="model.reservation.Reservation">
        INSERT INTO RESERVATION (
            RESERVATION_ID,
            RESERVATION_DATE,
            START_DATE,
            END_DATE,
            ADDRESS,
            VARIETY,
            PET_NAME,
            PHONENUMBER,
            SITTER,
            PRICE,
            REPLY,
            ADDRESSDETAIL,
            CREATE_ID,
            CREATE_DT,
            UPDATE_ID,
            UPDATE_DT,
            DEL_YN
        ) VALUES (
            SEQ_RESERVATION.NEXTVAL,
            #{reservationDate},
            #{startDate},
            #{endDate},
            #{address},
            #{variety},
            #{petName},
            #{phoneNumber},
            #{sitter},
            #{price},
            #{reply},
            #{addressDetail},
            #{createId},
            SYSDATE,
            NULL,
            NULL,
            'N'
        )
        <selectKey keyProperty="reservationId" resultType="int" order="AFTER">
            SELECT SEQ_RESERVATION.CURRVAL FROM DUAL
        </selectKey>
    </insert>

    <!-- 예약신청 목록 조회 -->
    <select id="getReservationList" parameterType="model.reservation.Reservation" resultType="model.reservation.Reservation">
        SELECT
            B.RN,
            B.RESERVATION_ID,
            B.START_DATE,
            B.END_DATE,
            B.ADDRESS,
            B.VARIETY,
            B.PET_NAME,
            B.PHONENUMBER,
            B.SITTER,
            B.PRICE,
            B.ADDRESSDETAIL,
            B.CREATE_ID,
            B.UPDATE_ID,
            B.CREATE_DT,
            B.UPDATE_DT,
            B.DEL_YN
        FROM (
            SELECT
                ROWNUM AS RN,
                A.RESERVATION_ID,
                TO_CHAR(A.START_DATE, 'YYYY-MM-DD') AS START_DATE,
                TO_CHAR(A.END_DATE, 'YYYY-MM-DD') AS END_DATE,
                A.ADDRESS,
                A.VARIETY,
                A.PET_NAME,
                A.PHONENUMBER,
                A.SITTER,
                A.PRICE,
                A.ADDRESSDETAIL,
                A.CREATE_ID,
                A.UPDATE_ID,
                TO_CHAR(A.CREATE_DT, 'YYYY-MM-DD') AS CREATE_DT,
                TO_CHAR(A.UPDATE_DT, 'YYYY-MM-DD') AS UPDATE_DT,
                A.DEL_YN
            FROM RESERVATION A
            WHERE A.DEL_YN = 'N'
        ) B
        WHERE B.RN BETWEEN #{startRow} AND #{endRow}
    </select>

    <!-- 총 예약 건수 -->
    <select id="getTotalReservationCount" resultType="int">
        SELECT COUNT(*) FROM RESERVATION WHERE DEL_YN = 'N'
    </select>

    <!-- 예약 ID로 조회 -->
    <select id="getReservationById" parameterType="string" resultType="model.reservation.Reservation">
        SELECT
            RESERVATION_ID,
            RESERVATION_DATE,
            START_DATE,
            END_DATE,
            ADDRESS,
            VARIETY,
            PET_NAME,
            PHONENUMBER,
            SITTER,
            PRICE,
            REPLY,
            ADDRESSDETAIL,
            CREATE_ID,
            UPDATE_ID,
            CREATE_DT,
            UPDATE_DT,
            DEL_YN
        FROM RESERVATION
        WHERE RESERVATION_ID = #{reservationId}
        AND DEL_YN = 'N'
    </select>

    <!-- 예약 수정 -->
    <update id="updateReservation" parameterType="model.reservation.Reservation">
        UPDATE RESERVATION
        SET
            RESERVATION_DATE = #{reservationDate},
            START_DATE = TO_DATE(#{startDate}, 'YYYY-MM-DD'),
            END_DATE = TO_DATE(#{endDate}, 'YYYY-MM-DD'),
            ADDRESS = #{address},
            VARIETY = #{variety},
            PET_NAME = #{petName},
            PHONENUMBER = #{phoneNumber},
            SITTER = #{sitter},
            PRICE = #{price},
            REPLY = #{reply},
            ADDRESSDETAIL = #{addressDetail},
            UPDATE_ID = #{updateId},
            UPDATE_DT = SYSDATE
        WHERE RESERVATION_ID = #{reservationId}
    </update>

    <!-- 예약 삭제 -->
    <update id="deleteReservation" parameterType="model.reservation.Reservation">
        UPDATE RESERVATION
        SET
            DEL_YN = 'Y',
            UPDATE_ID = #{updateId},
            UPDATE_DT = SYSDATE
        WHERE RESERVATION_ID = #{reservationId}
    </update>
	<insert id="createReservation" parameterType="model.reservation.Reservation">
        INSERT INTO reservations (board_id, user_id, sitter_id, reservation_date, details)
        VALUES (#{boardId}, #{userId}, #{sitterId}, #{reservationDate}, #{details})
    </insert>
    
    <insert id="insertReservation" parameterType="model.reservation.Reservation">
	    INSERT INTO reservation_table (
	        id, user_id, sitter_id, reservation_date, start_time, end_time, notes
	    )
	    VALUES (
	        #{id}, #{userId}, #{sitterId}, #{reservationDate}, #{startTime}, #{endTime}, #{notes}
	    )
	</insert>
</mapper>
